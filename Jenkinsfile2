
podTemplate(yaml: '''
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: docker
    image: docker:19.03.1-dind
    securityContext:
      privileged: true
    env:
      - name: DOCKER_TLS_CERTDIR
        value: ""
''') {
    environment{
        DOCKER_IMAGE_NAME = "foodkart_backend"
        AWS_ACCOUNT_ID = "232120535331"
        AWS_DEFAULT_REGION = "us-west-1" 
        IMAGE_REPO_NAME = "devsecops-backend"
        IMAGE_TAG = "latest"
        REPOSITORY_URI = "${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com/${IMAGE_REPO_NAME}"
        TASK_FAMILY = "devsecops-backend"
        SERVICE_NAME = "ecs-backend"
        DESIRED_COUNT ="2" 
        SHORT_COMMIT = "${GIT_COMMIT[0..7]}"
        EXECUTION_ROLE_ARN = "arn:aws:iam::232120535331:role/ecsTaskExecutionRole"
        CLUSTER_NAME = "DevSecOps-demo"

        SONAR_AUTH_TOKEN = "03baa10c2812ddd7e8be281c1d960a96c2029bf7"
        JAVA_REPO_URL="git@gitlab.xpanxion.com:digitalassetshub/devops/devsecops/DevSecOps_Java_Backend.git"
        REPO_PATH="/home/jenkins/agent/workspace/backend_pipeline/"
        DIR_PATH="/home/jenkins/agent/workspace/backend_pipeline/ecommerceapi/"
    }
    
    node(POD_LABEL) {
        git 'https://github.com/nginxinc/docker-nginx.git'
        container('docker') {
            sh 'docker version && cd stable/alpine/ && docker build -t nginx-example .'
        }
    }
}
